操作系统建议使用 Ubuntu。

选择一个可写入的目录，`/opt` 肯定不行。建议创建 `/export` 目录，与此处配置一致。

安装 Docker，不要使用 Snap 版 Docker，使用官方标准版 Docker。

安装 pip 和 nodejs，nodejs 版本需 >= 18。

正式开始：

1. `/export` 目录下新建 `jupyterhub` 目录，此为项目根目录。

   `/export/jupyterhub` 下新建 `config` 目录，此为配置文件目录。

   `cd /export/jupyterhub/config`

2. 安装虚拟环境工具

   `sudo apt install python3-venv -y`

3. 创建虚拟环境

   `python3 -m venv /export/jupyterhub/jupyterhub-venv`

4. 激活虚拟环境

   `source /export/jupyterhub/jupyterhub-venv/bin/activate`

5. 安装 jupyterhub

   `pip install jupyterhub notebook jupyterlab jupyterhub-idle-culler`

6. 安装代理工具

   `npm install -g configurable-http-proxy`

7. 测试是否安装成功

   `jupyterhub -h`

   `configurable-http-proxy -h`

8. 拉取镜像

   ```bash
   # 用于创建 jupyterhub
   docker pull jupyterhub/jupyterhub
   # 用于创建实际运行的 jupyter
   docker pull jupyter/base-notebook
   ```

9. 创建 Docker 网络

   `docker network create jupyterhub`

10. 将仓库中的配置文件全部复制到 `/export/jupyterhub/config` 目录下：

    - jupyterhub_config.py：jupyterhub 配置文件
    - shu_jupyterhub_Dockerfile：jupyterhub 容器的 Dockerfile
    - single_user_Dockerfile：单用户容器的 Dockerfile
    - admin_lab_config.json：管理员的 nbgrader 配置文件
    - student_lab_config.json：普通用户的 nbgrader 配置文件
    - page_templates 文件夹：jupyterhub 页面模板
    - start.sh：启动脚本

11. 构建镜像

    ```bash
    docker build -t shu_jupyterhub -f shu_jupyterhub_Dockerfile .
    
    docker build -t single_user -f single_user_Dockerfile .
    ```

12. 启动脚本赋权

    `chmod +x start.sh`

13. 启动

    `./start.sh`

    启动方式为后台启动，关闭命令：`docker stop jupyterhub`

查看本机 ip，访问 `xxx.xxx.xxx.xxx:8081` 即可。

如果访问失败，先 ping 一下 ip，如果可以 ping 通，则大概率是防火墙没有放行端口，命令：`sudo ufw allow 8081/tcp`。

使用任意用户名 + 固定密码 `123456` 即可登录，此方式登录的都是普通用户。

管理员角色的账号需由已有的管理员创建，配置时初始化了一个管理员用户：`root` `123456`。
